
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>Concurrency in Connector &#8212; DataPrep 0.2.15 documentation</title>
  
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
  <link href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-wvfXpqpZZVQGK6TAh5PVlGOfQNHSoD2xbE+QkPxCAFlNEevoEH3Sl0sibVcOQVnN" crossorigin="anonymous">
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/sphinx-bootstrap.css" type="text/css" />
  <link href="../../_static/custom.css" rel="stylesheet">
    <script id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="https://unpkg.com/@jupyter-widgets/html-manager@^0.20.0/dist/embed-amd.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Pagination in Connector" href="connector_pagination.html" />
    <link rel="prev" title="Authorization schemes supported by Connector" href="connector_authorization.html" />
  <meta charset="utf-8">
  <meta name="description" content="DataPrep, documentation site.">
  <meta name="author" content="SFU Database Systems Lab">
  <meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
  <meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
  <meta name="apple-mobile-web-app-capable" content="yes">
  <link href="https://fonts.googleapis.com/css?family=Lato|Work+Sans:400,600,700&display=swap" rel="stylesheet">
  <link rel="apple-touch-icon" sizes="180x180" href="https://raw.githubusercontent.com/sfu-db/dataprep/develop/assets/icon_cropped.jpg">
  <link rel="icon" type="image/png" sizes="32x32" href="https://raw.githubusercontent.com/sfu-db/dataprep/develop/assets/icon_cropped.jpg">
  <link rel="icon" type="image/jpg" sizes="16x16" href="https://raw.githubusercontent.com/sfu-db/dataprep/develop/assets/icon_cropped.jpg">
  <link rel="mask-icon" href="https://raw.githubusercontent.com/sfu-db/dataprep/develop/assets/icon_cropped.jpg" color="#5bbad5">
  <meta name="msapplication-TileColor" content="#da532c">
  <meta name="theme-color" content="#ffffff">
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-27761864-7"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'UA-27761864-7', {'anonymize_ip': true});
  </script>
<link rel="canonical" href="https://docs.bokeh.org/en/latest/user_guide/connector/connector_concurrency.html" />
  </head>
<body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60"><nav class="navbar navbar-light navbar-expand-lg bg-light bd-navbar fixed-top" id="navbar-main">
  <a class="navbar-brand" href="../../index.html">
    <img src="https://raw.githubusercontent.com/sfu-db/dataprep/develop/assets/logo_cropped.jpg" alt="DataPrep"
      height="60" width="210">
  </a>

  <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-menu"
    aria-controls="navbar-menu" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
  </button>

  <div id="navbar-menu" class="collapse navbar-collapse">
    <ul id="navbar-main-elements" class="navbar-nav mr-auto">
      
      
      <li class="nav-item ">
        <a class="nav-link" href="../../installation.html">Installation</a>
      </li>
      
      <li class="nav-item active">
        <a class="nav-link" href="../user_guide.html">User Guide</a>
      </li>
      
      <li class="nav-item ">
        <a class="nav-link" href="../../api_reference/dataprep.html">API Reference</a>
      </li>
      
      <li class="nav-item ">
        <a class="nav-link" href="../../contribute.html">Contribute</a>
      </li>
      
      <li class="nav-item ">
        <a class="nav-link" href="../../acknowledgement.html">Acknowledgement</a>
      </li>
      
      <li class="nav-item">
        <a class="nav-link nav-external" href="https://discord.gg/xwbkFNk" target="_blank" rel="noopener">
          Community
        </a>
      </li>
    </ul>
    <ul class="navbar-nav ml-auto">
      <li class="nav-item">
        <a class="nav-link" href="https://github.com/sfu-db/dataprep" target="_blank" rel="noopener">
          <span><i class="fa fa-github-square" style="color:#333;font-size:2rem;"></i></span>
        </a>
      </li>
      <li class="nav-item">
        <a class="nav-link" href="https://twitter.com/sfu_db" target="_blank" rel="noopener">
          <span><i class="fa fa-twitter-square" style="color:#55acee;font-size:2rem"></i></span>
        </a>
      </li>
      </li>
      <li class="nav-item">
        <a class="nav-link" href="https://www.youtube.com/channel/UC7OpZsQwWcmuD0SUaOjGBMA" target="_blank"
          rel="noopener">
          <span><i class="fa fa-youtube-square" style="color:#FF0000;font-size:2rem"></i></span>
        </a>
      </li>
    </ul>
  </div>
</nav>

  <div class="container-fluid" id="banner"></div>

  <div class="container-fluid" id="main-content">

    <div class="row flex-xl-nowrap"><div class="col-12 col-md-3 col-xl-2 bd-sidebar">

  <form class="bd-search d-flex align-items-center" action="../../search.html" method="get">
    <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
  </form>

  <nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">

    <div class="bd-toc-item active">
    

    <ul class="nav bd-sidenav">
      
        
      
        
          
            
              <li class="">
                  <a href="../datasets/introduction.html">Datasets</a>
              </li>
            
          
            
              <li class="">
                  <a href="../eda/introduction.html">EDA</a>
              </li>
            
          
            
              <li class="active">
                  <a href="connector.html">Connector</a>
                  <ul>
                  
                      <li class="">
                          <a href="connector_authorization.html">Authorization schemes supported by Connector</a>
                      </li>
                  
                      <li class="active">
                          <a href="">Concurrency in Connector</a>
                      </li>
                  
                      <li class="">
                          <a href="connector_pagination.html">Pagination in Connector</a>
                      </li>
                  
                  </ul>
              </li>
            
          
            
              <li class="">
                  <a href="../clean/introduction.html">Clean</a>
              </li>
            
          
        
      
        
      
        
      
        
      
    </ul>

  </nav>
</div>

<div class="d-none d-xl-block col-xl-2 bd-toc">
  <nav id="bd-toc-nav">
    <ul class="nav section-nav flex-column">
      
        <li class="nav-item toc-entry toc-h2">
          <a href="#overview" class="nav-link">Overview</a>
        </li>
      
        <li class="nav-item toc-entry toc-h2">
          <a href="#concurrency-in-context-youtube" class="nav-link">Concurrency in context: Youtube</a>
        </li>
      
        <li class="nav-item toc-entry toc-h2">
          <a href="#concurrency-enabling-connector-to-issue-requests-in-parallel" class="nav-link">Concurrency: Enabling Connector to issue requests in parallel</a>
        </li>
      
    </ul>
  </nav>
</div>
        <main class="col-12 col-md-9 col-xl-8 py-md-3 pl-md-5 bd-content" role="main">
          <div>
            
  <div class="section" id="concurrency-in-connector">
<h1>Concurrency in Connector<a class="headerlink" href="#concurrency-in-connector" title="Permalink to this headline">¶</a></h1>
<div class="toctree-wrapper compound">
</div>
<div class="section" id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Permalink to this headline">¶</a></h2>
<p>Connector implements a mechanism to accelerate the data request process through a parallelism-based implementation. This feature allows users to retrieve data, in parallel, in less time.</p>
</div>
<div class="section" id="concurrency-in-context-youtube">
<h2>Concurrency in context: Youtube<a class="headerlink" href="#concurrency-in-context-youtube" title="Permalink to this headline">¶</a></h2>
<p>YouTube API provides several engaging endpoints, for example, the “videos” endpoint, which returns a collection of relevant videos matching a specified query.
To start, let’s review the existing configuration file for the “videos” endpoint available <a class="reference external" href="https://github.com/sfu-db/DataConnectorConfigs/blob/develop/youtube/videos.json">here</a>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="s2">&quot;version&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
<span class="s2">&quot;request&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="s2">&quot;url&quot;</span><span class="p">:</span> <span class="s2">&quot;https://www.googleapis.com/youtube/v3/search&quot;</span><span class="p">,</span>
    <span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="s2">&quot;GET&quot;</span><span class="p">,</span>
    <span class="s2">&quot;authorization&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;QueryParam&quot;</span><span class="p">,</span>
        <span class="s2">&quot;keyParam&quot;</span><span class="p">:</span> <span class="s2">&quot;key&quot;</span>
    <span class="p">},</span>
    <span class="s2">&quot;params&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;q&quot;</span><span class="p">:</span> <span class="n">true</span><span class="p">,</span>
        <span class="s2">&quot;part&quot;</span><span class="p">:</span> <span class="n">true</span><span class="p">,</span>
        <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="n">false</span><span class="p">,</span>
        <span class="s2">&quot;maxResults&quot;</span><span class="p">:</span> <span class="n">false</span><span class="p">,</span>
        <span class="s2">&quot;pageToken&quot;</span><span class="p">:</span> <span class="n">false</span>
    <span class="p">},</span>
    <span class="o">...</span>
<span class="p">}</span>
</pre></div>
</div>
<p>As you can see in the “params” property, five parameters are defined for this endpoint: <code class="docutils literal notranslate"><span class="pre">q</span></code> and <code class="docutils literal notranslate"><span class="pre">part</span></code> are mandatory, and the remaining ones are optional: <code class="docutils literal notranslate"><span class="pre">type</span></code>, <code class="docutils literal notranslate"><span class="pre">maxResults</span></code>, and <code class="docutils literal notranslate"><span class="pre">pageToken</span></code>. See more details on the YouTube API specification webpage.
Employing the <code class="docutils literal notranslate"><span class="pre">q</span></code> parameter, you can put any string to search. The <code class="docutils literal notranslate"><span class="pre">part</span></code> parameter indicates the resource that the API response will include. It must always be set to <code class="docutils literal notranslate"><span class="pre">snippet</span></code>.</p>
<p>Now, you can execute the query:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">asyncio</span>
<span class="kn">from</span> <span class="nn">dataprep.connector</span> <span class="kn">import</span> <span class="n">connect</span>
<span class="n">youtube_connector</span> <span class="o">=</span> <span class="n">connect</span><span class="p">(</span><span class="s2">&quot;youtube&quot;</span><span class="p">,</span> <span class="n">_auth</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;access_token&quot;</span><span class="p">:</span><span class="s2">&quot;&lt;Your YouTube access token&gt;&quot;</span><span class="p">})</span>
<span class="n">df</span> <span class="o">=</span> <span class="k">await</span> <span class="n">youtube_connector</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;videos&quot;</span><span class="p">,</span> <span class="n">q</span><span class="o">=</span><span class="s2">&quot;data science&quot;</span><span class="p">,</span> <span class="n">part</span><span class="o">=</span><span class="s2">&quot;snippet&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Let’s review the obtained results:</p>
<a class="reference internal image-reference" href="../../_images/connector_youtube_query.png"><img alt="../../_images/connector_youtube_query.png" class="align-center" src="../../_images/connector_youtube_query.png" style="width: 964px; height: 181px;" /></a>
<p>For the “videos” endpoint, by default, the maximum number of search results to return for each request is 5. However, with Connector, you can also specify the desired record number you want to get by including the <code class="docutils literal notranslate"><span class="pre">_count</span></code> argument.</p>
<p>Now, let’s add the <code class="docutils literal notranslate"><span class="pre">_count</span></code> argument to the <code class="docutils literal notranslate"><span class="pre">query</span></code> function and give it “300” as a value:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">asyncio</span>
<span class="kn">from</span> <span class="nn">dataprep.connector</span> <span class="kn">import</span> <span class="n">connect</span>
<span class="n">youtube_connector</span> <span class="o">=</span> <span class="n">connect</span><span class="p">(</span><span class="s2">&quot;youtube&quot;</span><span class="p">,</span> <span class="n">_auth</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;access_token&quot;</span><span class="p">:</span><span class="s2">&quot;&lt;Your YouTube access token&gt;&quot;</span><span class="p">})</span>
<span class="n">df</span> <span class="o">=</span> <span class="k">await</span> <span class="n">youtube_connector</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;videos&quot;</span><span class="p">,</span> <span class="n">q</span><span class="o">=</span><span class="s2">&quot;data science&quot;</span><span class="p">,</span> <span class="n">part</span><span class="o">=</span><span class="s2">&quot;snippet&quot;</span><span class="p">,</span> <span class="n">_count</span><span class="o">=</span><span class="mi">300</span><span class="p">)</span>
</pre></div>
</div>
<p>Let’s execute this query again:</p>
<a class="reference internal image-reference" href="../../_images/connector_youtube_query_2.png"><img alt="../../_images/connector_youtube_query_2.png" class="align-center" src="../../_images/connector_youtube_query_2.png" style="width: 952px; height: 367px;" /></a>
<p>As you can see, the result includes exactly 300 records! (see more details about the auto-pagination feature in the <a class="reference internal" href="connector_pagination.html#connector-pagination"><span class="std std-ref">Pagination in Connector</span></a> section of this guide).</p>
<p>However, when the query is executed, it is noticeable that the execution time is perceptibly longer. This event occurred because the <code class="docutils literal notranslate"><span class="pre">_count</span></code> argument value was increased, and therefore, more requests are issued to the underlying API to retrieve the desired data.</p>
<p>To alleviate this problem, in the next section, we’ll introduce the concurrency feature in Connector.</p>
</div>
<div class="section" id="concurrency-enabling-connector-to-issue-requests-in-parallel">
<h2>Concurrency: Enabling Connector to issue requests in parallel<a class="headerlink" href="#concurrency-enabling-connector-to-issue-requests-in-parallel" title="Permalink to this headline">¶</a></h2>
<p>Connector offers the <code class="docutils literal notranslate"><span class="pre">_concurrency</span></code> parameter as part of the <code class="docutils literal notranslate"><span class="pre">connect</span></code> function. Its objective is to accelerate the query execution process when many requests must be sent out, as is the case when the <code class="docutils literal notranslate"><span class="pre">_count</span></code> parameter is used with a significant value.</p>
<p>By default, the <code class="docutils literal notranslate"><span class="pre">_concurrency</span></code> setting is “1”, which means that Connector will send out one request per second. However, if this value is increased to, let’s say, 10, Connector will send out ten requests in one second:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">asyncio</span>
<span class="kn">from</span> <span class="nn">dataprep.connector</span> <span class="kn">import</span> <span class="n">connect</span>
<span class="n">youtube_connector</span> <span class="o">=</span> <span class="n">connect</span><span class="p">(</span><span class="s2">&quot;youtube&quot;</span><span class="p">,</span> <span class="n">_auth</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;access_token&quot;</span><span class="p">:</span><span class="s2">&quot;&lt;Your YouTube access token&gt;&quot;</span><span class="p">},</span> <span class="n">_concurrency</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="n">df</span> <span class="o">=</span> <span class="k">await</span> <span class="n">youtube_connector</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;videos&quot;</span><span class="p">,</span> <span class="n">q</span><span class="o">=</span><span class="s2">&quot;data science&quot;</span><span class="p">,</span> <span class="n">part</span><span class="o">=</span><span class="s2">&quot;snippet&quot;</span><span class="p">,</span> <span class="n">_count</span><span class="o">=</span><span class="mi">300</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>


          </div>
        </main>

    </div>
  </div>  <script>
    // TOC sidebar - add "active" class to parent list
    //
    // Bootstrap's scrollspy adds the active class to the <a> link,
    // but for the automatic collapsing we need this on the parent list item.
    //
    // The event is triggered on "window" (and not the nav item as documented),
    // see https://github.com/twbs/bootstrap/issues/20086
    $(window).on("activate.bs.scrollspy", function(){
    var navLinks = document.querySelectorAll('#bd-toc-nav a');
    for (var i = 0; i < navLinks.length; i++) {
        var navLink = navLinks[i];
        navLink.parentElement.classList.remove('active');
    }
    var navLinks = document.querySelectorAll('#bd-toc-nav a.active');
    for (var i = 0; i < navLinks.length; i++) {
        var navLink = navLinks[i];
        navLink.parentElement.classList.add('active');
    }
    });
  </script>
  <footer class="container-fluid footer-copy">

    <div class="container">

      <div class="row">
        <div class="col-md-10 py-2">
          <p>
            ©2020 SFU Database Systems Lab. <a href="https://data.cs.sfu.ca/index.html">SFU Data Science Research Group</a>.
          </p>
          <p>
            Created using <a href="https://www.sphinx-doc.org/en/master/">Sphinx</a>.
          </p>
        </div>
      </div>

    </div>

  </footer>
  </body>
</html>